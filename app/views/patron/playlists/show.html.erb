<h2>Playlist</h2>

<div ng-app ng-init="playlist_id = '<%= @playlist.id %>';">

  <div ng-controller="vp.patron.SuggestTrack">

    <input type="text" name="search" class="track-search" autocomplete="off"
           ng-model="searchQuery"
           ng-change="findTracks(searchQuery)"/>

    <table class="table table-striped table-bordered">
      <tbody>
      <tr ng-repeat="track in tracks">
        <td ng-click="chooseTrack(track)">
          {{ track.title }} ({{ track.user.username }})
        </td>
      </tr>
      </tbody>
    </table>

  </div>

  <div ng-controller="vp.patron.Player">

    <div class="currently-playing-track">
      <p class="label">Now playing:</p>

      <p>{{playlist.now_playing.track.title}}</p>

      <p>{{playlist.now_playing.track.user.username}}</p>
    </div>

    <div class="upcoming-placements">
      <p class="label">Upcoming:</p>
      <table class="table table-striped table-bordered">
        <tbody>
        <tr ng-repeat="placement in playlist.upcoming_placements">
          <td>
            {{ placement.track.title }} ({{ placement.track.user.username }})
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="unvoted-placements">
      <p class="label">Vote:</p>
      <table class="table table-striped table-bordered">
        <tbody>
        <tr ng-repeat="placement in playlist.unvoted_placements">
          <td>
            {{ placement.track.title }} ({{ placement.track.user.username }})
          </td>
          <td>
            <a href="#" class="upvote" ng-click="upvote(placement)">Upvote</a>
          </td>
          <td>
            <a href="#" class="dismiss" ng-click="dismiss(placement)">Dismiss</a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>